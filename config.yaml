# SDI-RealtimeSubtitle 설정 파일
# 모든 값은 환경변수로 오버라이드 가능 (PREFIX: SRS_)
# 예: SRS_STT_API_KEY=xxx

system:
  mode: "live"                    # "live" | "file" (테스트 모드)
  log_level: "INFO"               # DEBUG | INFO | WARNING | ERROR
  log_format: "json"              # "json" | "text"
  log_dir: "output/logs"
  session_id: ""                  # 비어있으면 자동생성 (UUID)

capture:
  device_index: 0                 # DeckLink 장치 인덱스
  video_mode: "1080p30"           # 1080i50 | 1080p30 | 1080p25 | 720p60
  pixel_format: "yuv422"          # yuv422 | bgra
  audio_channels: [1, 2]          # 사용할 SDI 임베디드 채널 번호 (1~8)
  audio_sample_rate: 48000        # SDI 원본 샘플링레이트 (Hz)
  audio_bit_depth: 24             # SDI 원본 비트뎁스
  video_queue_size: 30            # 비디오 큐 최대 프레임 수
  audio_queue_size: 100           # 오디오 큐 최대 패킷 수

  # 테스트 모드 설정 (mode: "file" 일 때 사용)
  test_file:
    audio_path: "tests/fixtures/sample_audio.wav"
    video_path: ""                # 비어있으면 검정 배경 생성
    loop: false                   # 파일 반복 재생
    playback_speed: 1.0           # 재생 속도 (1.0 = 실시간)

audio:
  output_sample_rate: 16000       # STT 입력 샘플링레이트 (Hz)
  output_bit_depth: 16            # STT 입력 비트뎁스
  output_channels: 1              # mono
  gain_db: 0.0                    # 게인 조정 (dB, -20.0 ~ +20.0)
  chunk_size_ms: 100              # STT 전송 청크 크기 (밀리초)
  vad:
    enabled: true
    mode: 3                       # WebRTC VAD 공격성 (0~3, 3=가장 공격적)
    padding_ms: 300               # 음성 종료 후 추가 패딩 (ms)

stt:
  endpoint: "clovaspeech-gw.ncloud.com:50051"
  api_key: ""                     # 환경변수 SRS_STT_API_KEY 사용 권장
  secret_key: ""                  # 환경변수 SRS_STT_SECRET_KEY 사용 권장
  language: "ko-KR"               # ko-KR | en-US | ja-JP
  domain: "general"               # general | finance | medical
  model: "general"                # 사용 가능한 모델 식별자
  use_ssl: true
  timeout_sec: 30
  max_reconnect_attempts: 5
  reconnect_backoff_base_sec: 1   # 재연결 backoff: 1, 2, 4, 8, 16초
  reconnect_backoff_max_sec: 16
  result_queue_size: 50

subtitle:
  show_partial: true              # partial 결과 표시 여부
  partial_update_interval_ms: 200 # partial 갱신 주기 (ms)
  sync_offset_ms: 0               # 자막 표시 시점 오프셋 (양수=지연, 음수=앞당김)
  display_duration_ms: 3000       # final 자막 표시 유지 시간 (ms)
  history_size: 100               # 자막 히스토리 버퍼 크기
  font:
    path: "/System/Library/Fonts/AppleSDGothicNeo.ttc"   # macOS 기본 한글 폰트
    size: 36
    color: "#FFFFFF"              # 텍스트 색상 (HEX)
    background_color: "#00000080" # 배경 색상 (HEX + 투명도)
    stroke_color: "#000000"
    stroke_width: 2
  position:
    x: 0.5                        # 가로 위치 (0.0~1.0, 0.5=중앙)
    y: 0.85                       # 세로 위치 (0.0~1.0, 0.85=하단)
    anchor: "center"              # center | left | right
  export:
    enabled: true
    format: ["srt", "vtt"]        # 저장 포맷
    output_dir: "output/subtitles"

accuracy:
  enabled: false                  # WER/CER 측정 활성화
  reference_source: "file"        # "file" | "realtime"
  reference_file: ""              # reference_source: file 일 때 경로
  report_interval_sec: 60         # 중간 리포트 출력 주기
  output_dir: "output/reports"

metrics:
  latency_window_sec: 60          # 지연시간 통계 계산 윈도우 (초)
  metrics_output_dir: "output/reports"
  prometheus:
    enabled: false                # Phase 3
    port: 9090

dashboard:
  type: "tui"                     # "tui" | "web" | "none"
  refresh_interval_ms: 500        # 대시보드 갱신 주기 (ms)
  audio_meter_interval_ms: 100    # 오디오 미터 갱신 주기
  web:                            # Phase 3
    host: "0.0.0.0"
    port: 8080

alerts:
  stt_error_threshold: 3          # 이 횟수 연속 STT 오류 시 알림
  frame_drop_rate_threshold: 0.01 # 1% 이상 프레임 드롭 시 알림
  e2e_latency_alert_ms: 3000      # end-to-end 지연 이 값 초과 시 알림
  audio_silence_sec: 5            # 이 시간 이상 무음 지속 시 알림
